{% form_theme form _self %}

{% block genemu_jqueryselect2_hidden_widget %}
<div class="controls sonata-ba-field sonata-ba-field-standard-natural ">
    {{ form_widget(form) }}
</div>
{% endblock %}

{% block genemu_jqueryselect2_hidden_javascript %}
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            var $field = $('#{{ id }}');

            var $configs = {{ configs|json_encode|raw }};

            // custom configs
            $configs = $.extend($configs, {
                initSelection: function(element, callback) {
                    if($field.val().indexOf('__') != -1) {
                        var split = $field.val().split('__');
                        $field.val(split[0]);
                        callback({id: split[0], text: split[1] });
                    } else {
                        callback({id: $field.val(), text: $field.val() });
                    }
                },
                query: function (query) {
                    $.getJSON('{{path(configs.path)}}?name='+query.term, function(data) {
                        var ret = {results: []};
                        $.each(data, function() {
                            ret.results.push({id: this.{{configs.field_id}}, text: this.{{configs.field_name}}});
                        });
                        query.callback(ret);
                    });
                }
            });
            // end of custom configs

            $field.select2($configs);
        });
    </script>
{% endblock %}

{% block mmunit_widget %}
    <div class="control-group">
    {{ form_widget(form) }}
    </div>
{% endblock %}